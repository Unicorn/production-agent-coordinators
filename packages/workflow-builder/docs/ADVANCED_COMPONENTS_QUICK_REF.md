# Advanced Components Quick Reference

**Last Updated:** 2025-11-18

---

## ğŸš€ Quick Start

### Import Components

```tsx
// Child Workflow Components
import { ChildWorkflowCard } from '@/components/child-workflow';
import { ChildWorkflowNode } from '@/components/workflow/nodes';

// Connection Visualizer
import { WorkQueueConnectionVisualizer } from '@/components/workflow-builder/WorkQueueConnectionVisualizer';

// Utilities
import {
  buildAllConnections,
  detectCircularDependencies,
  validateConnectionIntegrity,
  getConnectionStats,
} from '@/utils/connection-path-utils';

// Types
import type {
  EnhancedWorkflowNode,
  WorkflowConnection,
  ConnectionPath,
} from '@/types/advanced-patterns';
```

---

## ğŸ“¦ Components

### ChildWorkflowCard

Display child workflow with parent communication indicators.

```tsx
<ChildWorkflowCard
  childWorkflow={enhancedNode}
  onUpdate={() => refetch()}
  onEdit={() => handleEdit()}
/>
```

**Shows:**
- ğŸ“¡ Parent communication (signal/query)
- ğŸš« Blocking dependencies
- âš™ï¸ Configuration
- ğŸ“Š Execution stats

---

### ChildWorkflowNode

Canvas node with visual indicators.

```tsx
// Automatically used when node type is 'child-workflow'
const nodes = [{
  id: 'child-1',
  type: 'child-workflow',
  position: { x: 100, y: 100 },
  data: {
    label: 'Data Processor',
    signalToParent: 'addToQueue',
    queryParent: 'getStatus',
    hasParentCommunication: true,
  }
}];

<ReactFlow nodes={nodes} nodeTypes={nodeTypes} />
```

**Indicators:**
- ğŸ“¤ Blue: Signals to parent
- ğŸ” Teal: Queries parent
- ğŸš« Orange: Blocked

---

### WorkQueueConnectionVisualizer

Visualize all connections in workflow.

```tsx
<WorkQueueConnectionVisualizer
  nodes={nodes}
  workflowId={workflowId}
  signals={signals}
  queries={queries}
  workQueues={workQueues}
  onClose={() => setShow(false)}
/>
```

**Features:**
- âœ… Connection validation
- ğŸ”„ Circular dependency detection
- ğŸ“Š Statistics dashboard
- ğŸ¨ Color-coded connections

---

## ğŸ› ï¸ Utilities

### Build Connections

```tsx
const connections = buildAllConnections(
  nodes,           // EnhancedWorkflowNode[]
  workflowId,      // string
  signals,         // WorkflowSignal[]
  queries,         // WorkflowQuery[]
  workQueues       // WorkflowWorkQueue[]
);
```

### Check Circular Dependencies

```tsx
const result = detectCircularDependencies(nodes);
if (result.hasCircularDependency) {
  console.error(result.message);
  console.error('Cycle:', result.cycle);
}
```

### Validate Connections

```tsx
const validation = validateConnectionIntegrity(
  connections,
  nodes,
  signals,
  queries,
  workQueues
);

if (!validation.valid) {
  validation.errors.forEach(err => console.error(err));
}
```

### Get Statistics

```tsx
const stats = getConnectionStats(connections);
// stats.total
// stats.byType.signal
// stats.byType.query
// stats.byType.blocking
// stats.autoGenerated
```

---

## ğŸ¨ Colors

| Element | Color | Token |
|---------|-------|-------|
| Child Workflow | Blue | `$blue9` |
| Signal | Orange | `$orange9` |
| Query | Teal | `$teal9` |
| Blocking | Orange/Red | `$orange9` / `$red9` |
| Work Queue | Yellow | `$yellow9` |
| Success | Green | `$green9` |
| Error | Red | `$red9` |

---

## ğŸ”¤ Icons

| Indicator | Icon | Meaning |
|-----------|------|---------|
| ğŸ“¤ | ArrowUp | Signals to parent |
| ğŸ” | Search | Queries parent |
| ğŸš« | PauseCircle | Blocked/waiting |
| ğŸ“¡ | - | Parent communication |
| âš¡ | - | Auto-generated |
| ğŸ“¥ | Inbox | Work queue |
| ğŸ”— | Network | Connection |
| âœ… | CheckCircle | Valid/success |
| âŒ | AlertCircle | Error/invalid |
| â° | Clock | Scheduled |

---

## ğŸ” Type Guards

```tsx
import {
  hasParentCommunication,
  hasBlockingDependencies,
} from '@/types/advanced-patterns';

if (hasParentCommunication(node)) {
  console.log('Can communicate with parent');
}

if (hasBlockingDependencies(node)) {
  console.log('Has blocking dependencies');
}
```

---

## ğŸ“ Complete Example

```tsx
'use client';

import { useState } from 'react';
import { YStack, Button } from 'tamagui';
import { Network } from 'lucide-react';
import { ChildWorkflowCard } from '@/components/child-workflow';
import { WorkQueueConnectionVisualizer } from '@/components/workflow-builder/WorkQueueConnectionVisualizer';
import { api as trpc } from '@/lib/trpc/client';

export default function WorkflowPage() {
  const [showConnections, setShowConnections] = useState(false);
  const workflowId = 'wf-123';

  // Fetch data
  const { data: nodes } = trpc.workflows.getNodes.useQuery({ 
    workflowId,
    type: 'child-workflow'
  });
  const { data: signals } = trpc.signals.list.useQuery({ workflowId });
  const { data: queries } = trpc.queries.list.useQuery({ workflowId });
  const { data: workQueues } = trpc.workQueues.list.useQuery({ workflowId });

  return (
    <YStack gap="$4" p="$4">
      <Button
        icon={Network}
        onPress={() => setShowConnections(true)}
      >
        View Connections
      </Button>

      {/* Child Workflow List */}
      {nodes?.map(node => (
        <ChildWorkflowCard key={node.id} childWorkflow={node} />
      ))}

      {/* Connection Visualizer */}
      {showConnections && (
        <WorkQueueConnectionVisualizer
          nodes={nodes || []}
          workflowId={workflowId}
          signals={signals}
          queries={queries}
          workQueues={workQueues}
          onClose={() => setShowConnections(false)}
        />
      )}
    </YStack>
  );
}
```

---

## ğŸ“š Full Documentation

- **Usage Guide:** `docs/ADVANCED_COMPONENTS_USAGE.md`
- **Completion Summary:** `docs/PHASE2_COMPLETION_SUMMARY.md`
- **Package Analysis:** `plans/PACKAGE_COMPARISON_REPORT.md`

---

## âœ… Status

**All Components:** âœ… Complete  
**Documentation:** âœ… Complete  
**Testing:** Ready  
**Production:** Ready

---

**Created:** 2025-11-18  
**Version:** 1.0.0

