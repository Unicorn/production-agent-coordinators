// Generated by workflow-compiler-rs v{{version}}
// DO NOT EDIT - This file is auto-generated from workflow definition
// Workflow: {{workflow_name}} ({{workflow_id}})
// Generated: {{generated_at}}

import {
  proxyActivities,
{{#if has_queries}}
  defineQuery,
{{/if}}
{{#if has_signals}}
  defineSignal,
  setHandler,
{{/if}}
{{#if is_long_running}}
  condition,
  workflowInfo,
  continueAsNew,
{{/if}}
} from '@temporalio/workflow';

import type * as activities from './activities';

// Type definitions for workflow
interface StartOutput {
  startedAt: Date;
}

interface StopOutput {
  completedAt: Date;
  success: boolean;
}

interface WorkflowResult {
  startedAt: Date;
  completedAt: Date;
  success: boolean;
  result: unknown;
}

{{#each proxy_declarations}}
// Activity proxy with {{timeout}} timeout
const {{var_name}} = proxyActivities<typeof activities>({
  startToCloseTimeout: '{{timeout}}',
{{#if has_retry}}
  retry: {
    maximumAttempts: {{retry_policy.max_attempts}},
    initialInterval: '{{retry_policy.initial_interval}}',
    maximumInterval: '{{retry_policy.max_interval}}',
    backoffCoefficient: {{retry_policy.backoff_coefficient}},
  },
{{/if}}
});

{{/each}}
{{#each variables}}
// Variable: {{name}} (type: {{var_type}})
{{/each}}

{{#if has_queries}}
// Query definitions
{{#each queries}}
export const {{name}}Query = defineQuery<{{return_type}}>('{{name}}');
{{/each}}
{{/if}}

{{#if has_signals}}
// Signal definitions
{{#each signals}}
export const {{name}}Signal = defineSignal<[{{param_types}}]>('{{name}}');
{{/each}}
{{/if}}

/**
 * {{workflow_name}} Workflow
 * Auto-generated workflow function
 */
export async function {{function_name}}(
  input: {{{input_type}}}
): Promise<{{{output_type}}}> {
{{#if is_long_running}}
  // Long-running workflow configuration
  let iterationCount = 0;
  const maxIterations = 100;

{{/if}}
{{#if has_signals}}
  // Set up signal handlers
{{#each signals}}
  setHandler({{name}}Signal, (payload: {{param_types}}) => {
    // Handle {{name}} signal
    console.log('Received {{name}} signal', payload);
  });
{{/each}}

{{/if}}
{{#each variables}}
  let {{name}}: {{var_type}} = {{default_value}};
{{/each}}

  // Workflow execution
  let result: {{{output_type}}} = undefined as {{{output_type}}};

{{#each code_blocks}}
  {{{this}}}
{{/each}}

{{#if is_long_running}}
  // Continue-as-new if needed
  iterationCount++;
  if (iterationCount >= maxIterations || workflowInfo().historyLength > 10000) {
    await continueAsNew<typeof {{function_name}}>(input);
  }
{{/if}}

  return result;
}
