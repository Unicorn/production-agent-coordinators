/**
 * Generated Temporal Workflow
 *
 * @generated by workflow-compiler v{{version}}
 * @date {{generated_at}}
 * @workflow {{workflow_name}}
 */

import {
  proxyActivities,
  defineSignal,
  setHandler,
  condition,
  sleep,
  workflowInfo,
  {{#if is_long_running}}
  CancellationScope,
  {{/if}}
} from '@temporalio/workflow';

import type { Activities } from './activities';

// Activity proxy with default timeout
const acts = proxyActivities<Activities>({
  startToCloseTimeout: '{{default_timeout}}',
  {{#if has_retry_policy}}
  retry: {
    maximumAttempts: {{retry_policy.max_attempts}},
    initialInterval: '{{retry_policy.initial_interval}}',
    maximumInterval: '{{retry_policy.max_interval}}',
    backoffCoefficient: {{retry_policy.backoff_coefficient}},
  },
  {{/if}}
});

// Input type for this workflow
export interface {{function_name}}Input {
  [key: string]: unknown;
}

// Output type for this workflow
export interface {{function_name}}Output {
  success: boolean;
  result: unknown;
}

{{#if has_signals}}
// Signal definitions
{{#each signals}}
export const {{name}}Signal = defineSignal<[{{param_types}}]>('{{name}}');
{{/each}}
{{/if}}

{{#if has_queries}}
// Query definitions
// TODO: Add query definitions
{{/if}}

{{#if has_variables}}
// Workflow state variables
interface WorkflowState {
  {{#each variables}}
  {{name}}: {{type}};
  {{/each}}
}
{{/if}}

/**
 * {{workflow_name}} Workflow
 *
 * Generated from workflow definition: {{workflow_id}}
 */
export async function {{function_name}}(
  input: {{function_name}}Input
): Promise<{{function_name}}Output> {
  {{#if has_variables}}
  // Initialize state
  const state: WorkflowState = {
    {{#each variables}}
    {{name}}: {{#if default_value}}{{default_value}}{{else}}undefined as unknown as {{type}}{{/if}},
    {{/each}}
  };
  {{/if}}

  {{#if has_signals}}
  // Register signal handlers
  {{#each signals}}
  setHandler({{name}}Signal, (payload) => {
    // Handle {{name}} signal
    console.log('Received signal: {{name}}', payload);
  });
  {{/each}}
  {{/if}}

  try {
    // Workflow execution
    {{#each code_blocks}}
    {{{this}}}
    {{/each}}
  } catch (error) {
    console.error('Workflow execution failed:', error);
    return {
      success: false,
      result: error instanceof Error ? error.message : 'Unknown error',
    };
  }
}
